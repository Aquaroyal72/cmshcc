{
    "contents" : "icd9RiskAdjCMSHCC13 <- function(DIAG, PERSON, cmshcc_list, date = Sys.Date(), factor_list = factors) {\n  PERSON$AGE <- as.numeric(round(difftime(date, as.Date(PERSON$DOB, \"%Y-%m-%d\", tz = \"UTC\"), units = \"weeks\")/52.25))\n  PERSON$DISABL <- (PERSON$AGE < 65) & (PERSON$OREC != 0)\n  PERSON$ORIGDS <- (PERSON$AGE >= 65) & (PERSON$OREC %in% c(1,3))\n  breaks <- c(0, 35, 45, 55, 60, 65, 70, 75, 80, 85, 90, 95, 120)\n  PERSON$AGE_BAND <- cut(x = PERSON$AGE, breaks = breaks, include.lowest = TRUE, right = FALSE)\n  \n  female_age_factors <- factor_list$female_age_factors\n  male_age_factors <- factor_list$male_age_factors\n  PERSON$AGEGENDER_SCORE <- (PERSON$SEX == 1) * male_age_factors[PERSON$AGE_BAND] + (PERSON$SEX == 2) * female_age_factors[PERSON$AGE_BAND]\n  \n  PERSON$MCAID_FEMALE_AGED <- (PERSON$MCAID == 1) & (PERSON$SEX == 2) & (PERSON$DISABL == 0)\n  PERSON$MCAID_FEMALE_DISABL <- (PERSON$MCAID == 1) & (PERSON$SEX == 2) & (PERSON$DISABL == 1)\n  PERSON$MCAID_MALE_AGED <- (PERSON$MCAID == 1) & (PERSON$SEX == 1) & (PERSON$DISABL == 0)\n  PERSON$MCAID_MALE_DISABL <- (PERSON$MCAID == 1) & (PERSON$SEX == 2) & (PERSON$DISABL == 1)\n  PERSON$ORIGDS_FEMALE <- (PERSON$ORIGDS == 1) & (PERSON$SEX == 2)\n  PERSON$ORIGDS_MALE <- (PERSON$ORIGDS == 1) & (PERSON$SEX == 1)\n  \n  demointeraction_factors <- factor_list$demointeraction_factors\n  PERSON$DEMOINTERACTION_SCORE <- as.matrix(PERSON[,c(\"MCAID_FEMALE_AGED\", \"MCAID_FEMALE_DISABL\", \"MCAID_MALE_AGED\", \"MCAID_MALE_DISABL\", \"ORIGDS_FEMALE\", \"ORIGDS_MALE\")]) %*% demointeraction_factors\n  \n  #Evaluate using icd9 package by Jack Wasey\n  PERSON <- cbind(PERSON, as.data.frame(icd9Comorbid(icd9df = DIAG, icd9Mapping = cmshcc_list, visitId = \"HICNO\")))\n  \n  #Apply Hierarchies\n  PERSON$HCC112 <- PERSON$HCC112 & (!PERSON$HCC5)\n  PERSON$HCC10 <- PERSON$HCC10 & (!PERSON$HCC9) & (!PERSON$HCC8) & (!PERSON$HCC7)\n  PERSON$HCC9 <- PERSON$HCC9 & (!PERSON$HCC8) & (!PERSON$HCC7)\n  PERSON$HCC8 <- PERSON$HCC8 & (!PERSON$HCC7)\n  PERSON$HCC19 <- PERSON$HCC19 & (!PERSON$HCC18) & (!PERSON$HCC17) & (!PERSON$HCC16) & (!PERSON$HCC15)\n  PERSON$HCC18 <- PERSON$HCC18 & (!PERSON$HCC17) & (!PERSON$HCC16) & (!PERSON$HCC15)\n  PERSON$HCC17 <- PERSON$HCC17 & (!PERSON$HCC16) & (!PERSON$HCC15)\n  PERSON$HCC16 <- PERSON$HCC16 & (!PERSON$HCC15)\n  PERSON$HCC27 <- PERSON$HCC27 & (!PERSON$HCC26) & (!PERSON$HCC25)\n  PERSON$HCC26 <- PERSON$HCC26 & (!PERSON$HCC25)\n  PERSON$HCC52 <- PERSON$HCC52 & (!PERSON$HCC51)\n  PERSON$HCC54 <- PERSON$HCC54 & (!PERSON$HCC55)\n  PERSON$HCC157 <- PERSON$HCC157 & (!PERSON$HCC69) & (!PERSON$HCC68) & (!PERSON$HCC67)\n  PERSON$HCC101 <- PERSON$HCC101 & (!PERSON$HCC100) & (!PERSON$HCC68) & (!PERSON$HCC67)\n  PERSON$HCC69 <- PERSON$HCC69 & (!PERSON$HCC68) & (!PERSON$HCC67)\n  PERSON$HCC100 <- PERSON$HCC100 & (!PERSON$HCC68) & (!PERSON$HCC67)\n  PERSON$HCC68 <- PERSON$HCC68 & (!PERSON$HCC67)\n  PERSON$HCC79 <- PERSON$HCC79 & (!PERSON$HCC78) & (!PERSON$HCC77)\n  PERSON$HCC78 <- PERSON$HCC78 & (!PERSON$HCC77)\n  PERSON$HCC83 <- PERSON$HCC83 & (!PERSON$HCC82) & (!PERSON$HCC81)\n  PERSON$HCC82 <- PERSON$HCC82 & (!PERSON$HCC81)\n  PERSON$HCC96 <- PERSON$HCC96 & (!PERSON$HCC95)\n  PERSON$HCC105 <- PERSON$HCC105 & (!PERSON$HCC104)\n  PERSON$HCC149 <- PERSON$HCC149 & (!PERSON$HCC148) & (!PERSON$HCC104)\n  PERSON$HCC108 <- PERSON$HCC108 & (!PERSON$HCC107)  \n  PERSON$HCC132 <- PERSON$HCC132 & (!PERSON$HCC131) & (!PERSON$HCC130)\n  PERSON$HCC131 <- PERSON$HCC131 & (!PERSON$HCC130)\n  PERSON$HCC75 <- PERSON$HCC75 & (!PERSON$HCC154)\n  PERSON$HCC155 <- PERSON$HCC155 & (!PERSON$HCC154)\n  PERSON$HCC177 <- PERSON$HCC177 & (!PERSON$HCC161)\n  \n  #Generate Disease Scores\n  disease_factors <- factor_list$disease_factors\n  PERSON$DISEASE_SCORE <- as.matrix(PERSON[, names(cmshcc_list)]) %*% disease_factors\n  \n  #Condition Category Groupings\n  PERSON$DM <- PERSON$HCC15 | PERSON$HCC16 | PERSON$HCC17 | PERSON$HCC18 | PERSON$HCC19\n  PERSON$CHF <- PERSON$HCC80\n  PERSON$COPD <- PERSON$HCC108\n  PERSON$CVD <- PERSON$HCC95 | PERSON$HCC96 | PERSON$HCC100 | PERSON$HCC101\n  PERSON$CAD <- PERSON$HCC81 | PERSON$HCC82 | PERSON$HCC83\n  PERSON$RF <- PERSON$HCC131\n  \n  #Disease x Disease Interaction Terms\n  PERSON$DM_CHF <- PERSON$DM & PERSON$CHF\n  PERSON$DM_CVD <- PERSON$DM & PERSON$CVD\n  PERSON$CHF_COPD <- PERSON$CHF & PERSON$COPD\n  PERSON$COPD_CVD_CAD <- PERSON$COPD & PERSON$CVD & PERSON$CAD\n  PERSON$RF_CHF <- PERSON$RF & PERSON$CHF\n  PERSON$RF_CHF_DM <- PERSON$RF & PERSON$CHF & PERSON$DM & (!PERSON$DM_CHF) & (!PERSON$RF_CHF)\n  \n  interaction_terms <- c(\"DM_CHF\", \"DM_CVD\", \"CHF_COPD\", \"COPD_CVD_CAD\", \"RF_CHF\", \"RF_CHF_DM\")\n  interaction_factors <- factor_list$interaction_factors\n  PERSON$DISEASE_INTERACTION <- as.matrix(PERSON[, interaction_terms]) %*% interaction_factors\n  \n  #Disability x Disease Interaction Terms\n  PERSON$DISABL_HCC5 <- PERSON$DISABL & PERSON$HCC5\n  PERSON$DISABL_HCC44 <- PERSON$DISABL & PERSON$HCC44\n  PERSON$DISABL_HCC51 <- PERSON$DISABL & PERSON$HCC51\n  PERSON$DISABL_HCC52 <- PERSON$DISABL & PERSON$HCC52\n  PERSON$DISABL_HCC107 <- PERSON$DISABL & PERSON$HCC107\n  \n  disabl_int_terms <- c(\"DISABL_HCC5\", \"DISABL_HCC44\", \"DISABL_HCC51\", \"DISABL_HCC52\", \"DISABL_HCC107\")\n  disabl_int_factors <- factor_list$disabl_int_factors\n  PERSON$DISABL_INTERACTION <- as.matrix(PERSON[, disabl_int_terms]) %*% disabl_int_factors\n  \n  #Total Risk Adjustment Scores\n  PERSON$TOTAL <- PERSON$AGEGENDER_SCORE + PERSON$DEMOINTERACTION_SCORE + PERSON$DISEASE_SCORE + PERSON$DISEASE_INTERACTION + PERSON$DISABL_INTERACTION\n  return(PERSON$TOTAL)\n}",
    "created" : 1436462855008.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1621766590",
    "id" : "95AAFDC3",
    "lastKnownWriteTime" : 1436479762,
    "path" : "~/ValidateHealth/cmshcc/R/model13.r",
    "project_path" : "R/model13.r",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "type" : "r_source"
}