icd9RiskAdjCMSHCC13 <- function(DIAG, PERSON, cmshcc_list) {
  PERSON$AGE <- as.numeric(round(difftime(Sys.Date(), as.Date(PERSON$DOB, "%Y-%m-%d", tz = "UTC"), units = "weeks")/52.25))
  PERSON$DISABL <- (PERSON$AGE < 65) & (PERSON$OREC != 0)
  PERSON$ORIGDS <- (PERSON$AGE >= 65) & (PERSON$OREC %in% c(1,3))
  breaks <- c(0, 35, 45, 55, 60, 65, 70, 75, 80, 85, 90, 95, 120)
  PERSON$AGE_BAND <- cut(x = PERSON$AGE, breaks = breaks, include.lowest = TRUE, right = FALSE)
  
  female_age_factors <- c(0.210, 0.217, 0.276, 0.343, 0.415, 0.279, 0.337, 0.426, 0.525, 0.651, 0.786, 0.822)
  male_age_factors <- c(0.117, 0.133, 0.193, 0.272, 0.337, 0.283, 0.346, 0.436, 0.534, 0.656, 0.824, .993)
  PERSON$AGEGENDER_SCORE <- (PERSON$SEX == 1) * male_age_factors[PERSON$AGE_BAND] + (PERSON$SEX == 2) * female_age_factors[PERSON$AGE_BAND]
  
  PERSON$MCAID_FEMALE_AGED <- (PERSON$MCAID == 1) & (PERSON$SEX == 2) & (PERSON$DISABL == 0)
  PERSON$MCAID_FEMALE_DISABL <- (PERSON$MCAID == 1) & (PERSON$SEX == 2) & (PERSON$DISABL == 1)
  PERSON$MCAID_MALE_AGED <- (PERSON$MCAID == 1) & (PERSON$SEX == 1) & (PERSON$DISABL == 0)
  PERSON$MCAID_MALE_DISABL <- (PERSON$MCAID == 1) & (PERSON$SEX == 2) & (PERSON$DISABL == 1)
  PERSON$ORIGDS_FEMALE <- (PERSON$ORIGDS == 1) & (PERSON$SEX == 2)
  PERSON$ORIGDS_MALE <- (PERSON$ORIGDS == 1) & (PERSON$SEX == 1)
  
  demointeraction_factors <- c(0.202, 0.103, 0.232, 0.099, 0.228, 0.160)
  PERSON$DEMOINTERACTION_SCORE <- as.matrix(PERSON[,c("MCAID_FEMALE_AGED", "MCAID_FEMALE_DISABL", "MCAID_MALE_AGED", "MCAID_MALE_DISABL", "ORIGDS_FEMALE", "ORIGDS_MALE")]) %*% demointeraction_factors
  
  #Evaluate using icd9 package by Jack Wasey
  PERSON <- cbind(PERSON, as.data.frame(icd9Comorbid(icd9df = DIAG, icd9Mapping = cmshcc_list, visitId = "HICNO")))
  
  #Apply Hierarchies
  PERSON$HCC112 <- PERSON$HCC112 & (!PERSON$HCC5)
  PERSON$HCC10 <- PERSON$HCC10 & (!PERSON$HCC9) & (!PERSON$HCC8) & (!PERSON$HCC7)
  PERSON$HCC9 <- PERSON$HCC9 & (!PERSON$HCC8) & (!PERSON$HCC7)
  PERSON$HCC8 <- PERSON$HCC8 & (!PERSON$HCC7)
  PERSON$HCC19 <- PERSON$HCC19 & (!PERSON$HCC18) & (!PERSON$HCC17) & (!PERSON$HCC16) & (!PERSON$HCC15)
  PERSON$HCC18 <- PERSON$HCC18 & (!PERSON$HCC17) & (!PERSON$HCC16) & (!PERSON$HCC15)
  PERSON$HCC17 <- PERSON$HCC17 & (!PERSON$HCC16) & (!PERSON$HCC15)
  PERSON$HCC16 <- PERSON$HCC16 & (!PERSON$HCC15)
  PERSON$HCC27 <- PERSON$HCC27 & (!PERSON$HCC26) & (!PERSON$HCC25)
  PERSON$HCC26 <- PERSON$HCC26 & (!PERSON$HCC25)
  PERSON$HCC52 <- PERSON$HCC52 & (!PERSON$HCC51)
  PERSON$HCC54 <- PERSON$HCC54 & (!PERSON$HCC55)
  PERSON$HCC157 <- PERSON$HCC157 & (!PERSON$HCC69) & (!PERSON$HCC68) & (!PERSON$HCC67)
  PERSON$HCC101 <- PERSON$HCC101 & (!PERSON$HCC100) & (!PERSON$HCC68) & (!PERSON$HCC67)
  PERSON$HCC69 <- PERSON$HCC69 & (!PERSON$HCC68) & (!PERSON$HCC67)
  PERSON$HCC100 <- PERSON$HCC100 & (!PERSON$HCC68) & (!PERSON$HCC67)
  PERSON$HCC68 <- PERSON$HCC68 & (!PERSON$HCC67)
  PERSON$HCC79 <- PERSON$HCC79 & (!PERSON$HCC78) & (!PERSON$HCC77)
  PERSON$HCC78 <- PERSON$HCC78 & (!PERSON$HCC77)
  PERSON$HCC83 <- PERSON$HCC83 & (!PERSON$HCC82) & (!PERSON$HCC81)
  PERSON$HCC82 <- PERSON$HCC82 & (!PERSON$HCC81)
  PERSON$HCC96 <- PERSON$HCC96 & (!PERSON$HCC95)
  PERSON$HCC105 <- PERSON$HCC105 & (!PERSON$HCC104)
  PERSON$HCC149 <- PERSON$HCC149 & (!PERSON$HCC148) & (!PERSON$HCC104)
  PERSON$HCC108 <- PERSON$HCC108 & (!PERSON$HCC107)  
  PERSON$HCC132 <- PERSON$HCC132 & (!PERSON$HCC131) & (!PERSON$HCC130)
  PERSON$HCC131 <- PERSON$HCC131 & (!PERSON$HCC130)
  PERSON$HCC75 <- PERSON$HCC75 & (!PERSON$HCC154)
  PERSON$HCC155 <- PERSON$HCC155 & (!PERSON$HCC154)
  PERSON$HCC177 <- PERSON$HCC177 & (!PERSON$HCC161)
  
  #Generate Disease Scores
  disease_factors <- c(.458, .766, .465, 2.175, .919, .706, .187, .371, .371, .371, .371, .127, .745, 1.006, .413, .262, .310, .362, .302, .585, .361, 1.129, .945, .373, .373, .517, .360, 1.147, 1.061, .491, .464, .321, .516, .643, .278, .580, 1.767, 1.117, .531, .346, .294, .274, .170, .289, .359, .265, .534, .131, .594, .302, .385, .340, .734, .206, .236, 1.348, .297, .116, 1.165, .476, 1.246, .580, .171, .467, .435, .793, .311, 1.084, .659, .793)
  PERSON$DISEASE_SCORE <- as.matrix(PERSON[, names(cmshcc_list)]) %*% disease_factors
  
  #Condition Category Groupings
  PERSON$DM <- PERSON$HCC15 | PERSON$HCC16 | PERSON$HCC17 | PERSON$HCC18 | PERSON$HCC19
  PERSON$CHF <- PERSON$HCC80
  PERSON$COPD <- PERSON$HCC108
  PERSON$CVD <- PERSON$HCC95 | PERSON$HCC96 | PERSON$HCC100 | PERSON$HCC101
  PERSON$CAD <- PERSON$HCC81 | PERSON$HCC82 | PERSON$HCC83
  PERSON$RF <- PERSON$HCC131
  
  #Disease x Disease Interaction Terms
  PERSON$DM_CHF <- PERSON$DM & PERSON$CHF
  PERSON$DM_CVD <- PERSON$DM & PERSON$CVD
  PERSON$CHF_COPD <- PERSON$CHF & PERSON$COPD
  PERSON$COPD_CVD_CAD <- PERSON$COPD & PERSON$CVD & PERSON$CAD
  PERSON$RF_CHF <- PERSON$RF & PERSON$CHF
  PERSON$RF_CHF_DM <- PERSON$RF & PERSON$CHF & PERSON$DM & (!PERSON$DM_CHF) & (!PERSON$RF_CHF)
  
  interaction_terms <- c("DM_CHF", "DM_CVD", "CHF_COPD", "COPD_CVD_CAD", "RF_CHF", "RF_CHF_DM")
  interaction_factors <- c(.150, .150, .278, .233, .262, .600)
  PERSON$DISEASE_INTERACTION <- as.matrix(PERSON[, interaction_terms]) %*% interaction_factors
  
  #Disability x Disease Interaction Terms
  PERSON$DISABL_HCC5 <- PERSON$DISABL & PERSON$HCC5
  PERSON$DISABL_HCC44 <- PERSON$DISABL & PERSON$HCC44
  PERSON$DISABL_HCC51 <- PERSON$DISABL & PERSON$HCC51
  PERSON$DISABL_HCC52 <- PERSON$DISABL & PERSON$HCC52
  PERSON$DISABL_HCC107 <- PERSON$DISABL & PERSON$HCC107
  
  disabl_int_terms <- c("DISABL_HCC5", "DISABL_HCC44", "DISABL_HCC51", "DISABL_HCC52", "DISABL_HCC107")
  disabl_int_factors <- c(.597, 1.340, .383, .105, 2.556)
  PERSON$DISABL_INTERACTION <- as.matrix(PERSON[, disabl_int_terms]) %*% disabl_int_factors
  
  #Total Risk Adjustment Scores
  PERSON$TOTAL <- PERSON$AGEGENDER_SCORE + PERSON$DEMOINTERACTION_SCORE + PERSON$DISEASE_SCORE + PERSON$DISEASE_INTERACTION + PERSON$DISABL_INTERACTION
  return(PERSON$TOTAL)
}